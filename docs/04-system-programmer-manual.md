# РУКОВОДСТВО СИСТЕМНОГО ПРОГРАММИСТА СИСТЕМЫ ПОДПИСИ И ПРОВЕРКИ ЦЕЛОСТНОСТИ ФАЙЛОВ

**Версия:** 1.0  
**Дата:** 2025  
**Статус:** Действующее

---

## СОДЕРЖАНИЕ

1. [Общие сведения](#1-общие-сведения)
2. [Структура системы](#2-структура-системы)
3. [Установка и настройка системы](#3-установка-и-настройка-системы)
4. [Конфигурация системы](#4-конфигурация-системы)
5. [Запуск и остановка системы](#5-запуск-и-остановка-системы)
6. [Диагностика и устранение неисправностей](#6-диагностика-и-устранение-неисправностей)
7. [Обслуживание системы](#7-обслуживание-системы)
8. [Безопасность](#8-безопасность)
9. [Производительность](#9-производительность)
10. [Интеграция с другими системами](#10-интеграция-с-другими-системами)
11. [Справочная информация](#11-справочная-информация)

---

## 1. Общие сведения

### 1.1. Назначение документа
Настоящее руководство предназначено для системных программистов, занимающихся установкой, настройкой и сопровождением системы. Документ содержит описание архитектуры системы, процедур установки, настройки и диагностики. Документ разработан в соответствии с требованиями ГОСТ 34.201-89 "Информационные технологии. Комплекс стандартов на автоматизированные системы. Виды, комплектность и обозначение документов при создании автоматизированных систем".

### 1.2. Краткая характеристика системы
Система представляет собой консольное приложение на языке Go, реализующее функциональность цифровой подписи и проверки целостности файлов с использованием асимметричной криптографии.

### 1.3. Состав системы
- Исходный код на языке Go
- Исполняемый бинарный файл
- Автоматические тесты
- Документация

## 2. Структура системы

### 2.1. Архитектура системы

```
security-signature/
├── cmd/
│   └── main.go              # Точка входа, CLI интерфейс
├── pkg/
│   └── signature/
│       ├── key.go           # Генерация ключевых пар
│       └── crypto.go        # Криптографические операции
├── tests/
│   └── signature_test.go    # Автоматические тесты
├── docs/                    # Документация
├── go.mod                   # Описание модуля
└── README.md                # Краткое описание
```

### 2.2. Описание модулей

#### 2.2.1. Модуль cmd/main.go
**Назначение**: Точка входа приложения, обработка командной строки

**Основные функции**:
- `main()` — точка входа, маршрутизация команд
- `runKeygen()` — обработка команды генерации ключей
- `runSign()` — обработка команды подписания
- `runVerify()` — обработка команды проверки
- `usage()` — вывод справки

**Зависимости**:
- `pkg/signature` — криптографические функции

#### 2.2.2. Модуль pkg/signature/key.go
**Назначение**: Генерация криптографических ключевых пар

**Экспортируемые функции**:
- `GenerateKeyPair(algorithm, rsaBits, curveName)` — генерация пары ключей

**Внутренние функции**:
- `generateRSAKeyPair(bits)` — генерация RSA ключей
- `generateECDSAKeyPair(curveName)` — генерация ECDSA ключей
- `selectCurve(name)` — выбор эллиптической кривой

**Используемые пакеты**:
- `crypto/rsa`, `crypto/ecdsa`, `crypto/elliptic` — криптография
- `crypto/x509`, `encoding/pem` — кодирование ключей
- `crypto/rand` — генерация случайных чисел

#### 2.2.3. Модуль pkg/signature/crypto.go
**Назначение**: Криптографические операции (хеширование, подпись, верификация)

**Экспортируемые функции**:
- `HashFileSHA256(path)` — вычисление SHA-256 хеша файла
- `SignDigest(privateKey, digest)` — подпись хеш-суммы
- `VerifyDigest(publicKey, digest, signature)` — проверка подписи
- `LoadPrivateKeyPEM(data)` — загрузка закрытого ключа из PEM
- `LoadPublicKeyPEM(data)` — загрузка открытого ключа из PEM
- `EncodeSignatureBase64(signature)` — кодирование подписи в Base64
- `DecodeSignatureBase64(data)` — декодирование подписи из Base64

**Используемые пакеты**:
- `crypto`, `crypto/rsa`, `crypto/ecdsa`, `crypto/sha256` — криптография
- `crypto/x509`, `encoding/pem` — работа с ключами
- `encoding/base64` — кодирование подписей
- `os`, `io` — работа с файлами

## 3. Установка и настройка системы

### 3.1. Требования к системе

#### 3.1.1. Аппаратные требования
- Процессор: любой, поддерживающий Go
- Память: минимум 512 МБ RAM
- Дисковое пространство: 50 МБ для установки

#### 3.1.2. Программные требования
- Операционная система: Windows 7+, Linux (любое распространение), macOS 10.12+
- Go версии 1.25.4 или выше (для сборки из исходников)
- Компилятор C (для сборки некоторых зависимостей Go, если требуется)

### 3.2. Установка системы

#### 3.2.1. Установка Go
**Windows**:
1. Скачайте установщик с https://golang.org/dl/
2. Запустите установщик и следуйте инструкциям
3. Проверьте установку: `go version`

**Linux**:
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install golang-go

# Или установка из официального репозитория
wget https://go.dev/dl/go1.25.4.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.25.4.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin
```

**macOS**:
```bash
brew install go
# Или скачайте установщик с https://golang.org/dl/
```

#### 3.2.2. Сборка системы из исходников

1. **Клонирование репозитория**:
   ```bash
   git clone https://github.com/snowwyd/security-signature.git
   cd security-signature
   ```

2. **Проверка зависимостей**:
   ```bash
   go mod download
   go mod verify
   ```

3. **Сборка для текущей платформы**:
   ```bash
   go build -o security-signature ./cmd
   ```

4. **Кроссплатформенная сборка**:
   ```bash
   # Linux
   GOOS=linux GOARCH=amd64 go build -o security-signature-linux ./cmd
   
   # Windows
   GOOS=windows GOARCH=amd64 go build -o security-signature.exe ./cmd
   
   # macOS
   GOOS=darwin GOARCH=amd64 go build -o security-signature-macos ./cmd
   ```

5. **Проверка сборки**:
   ```bash
   ./security-signature help
   ```

#### 3.2.3. Установка через go install
```bash
go install github.com/qyteboii/security-signature/cmd@latest
```
Бинарник будет установлен в `$GOPATH/bin` или `$HOME/go/bin`.

### 3.3. Настройка системы

#### 3.3.1. Настройка переменных окружения
Для удобства использования добавьте путь к бинарнику в PATH:

**Windows (PowerShell)**:
```powershell
[Environment]::SetEnvironmentVariable("Path", $Env:Path + ";C:\path\to\bin", "User")
```

**Linux/macOS**:
```bash
export PATH="$PATH:$HOME/go/bin"
echo 'export PATH="$PATH:$HOME/go/bin"' >> ~/.bashrc
```

#### 3.3.2. Настройка прав доступа
На Unix-системах установите права на исполнение:
```bash
chmod +x security-signature
```

Для закрытых ключей рекомендуется установить права 0600:
```bash
chmod 600 private_key.pem
```

## 4. Конфигурация системы

### 4.1. Параметры конфигурации
Система не использует файлы конфигурации. Все параметры передаются через аргументы командной строки.

### 4.2. Переменные окружения
Система не использует переменные окружения для конфигурации.

### 4.3. Параметры по умолчанию
- Алгоритм: RSA
- Размер RSA ключа: 2048 бит
- Кривая ECDSA: P-256
- Имя файла закрытого ключа: `private_key.pem`
- Имя файла открытого ключа: `public_key.pem`
- Имя файла подписи: `signature.sig`

## 5. Запуск и остановка системы

### 5.1. Запуск системы
Система запускается по требованию для выполнения конкретной операции:
```bash
./security-signature <command> [options]
```

### 5.2. Остановка системы
Система завершает работу автоматически после выполнения команды. Для принудительной остановки используйте `Ctrl+C`.

### 5.3. Режимы работы
Система работает в интерактивном режиме командной строки. Фоновый режим не поддерживается.

## 6. Диагностика и устранение неисправностей

### 6.1. Диагностика проблем

#### 6.1.1. Проверка установки
```bash
go version                    # Проверка версии Go
./security-signature help     # Проверка работы системы
```

#### 6.1.2. Проверка сборки
```bash
go build -v ./cmd             # Сборка с подробным выводом
go test ./...                 # Запуск тестов
```

#### 6.1.3. Проверка зависимостей
```bash
go mod verify                 # Проверка целостности зависимостей
go mod graph                  # Граф зависимостей
```

### 6.2. Типичные проблемы и решения

#### 6.2.1. Проблемы сборки

**Ошибка**: `go: cannot find main module`
**Решение**: Убедитесь, что находитесь в корне проекта с файлом `go.mod`

**Ошибка**: `package ... is not in GOROOT`
**Решение**: Проверьте правильность путей модуля в `go.mod`

#### 6.2.2. Проблемы выполнения

**Ошибка**: `permission denied`
**Решение**: 
- На Unix: `chmod +x security-signature`
- Проверьте права на файлы ключей и данные

**Ошибка**: `command not found`
**Решение**: Добавьте путь к бинарнику в PATH или используйте полный путь

#### 6.2.3. Проблемы с ключами

**Ошибка**: `no PEM block found`
**Решение**: Убедитесь, что файл ключа в формате PEM и не поврежден

**Ошибка**: `parse RSA private key: asn1: structure error`
**Решение**: Файл ключа поврежден или имеет неверный формат

### 6.3. Логирование и отладка

#### 6.3.1. Включение отладочного вывода
Система выводит сообщения об ошибках в stderr. Для более подробной диагностики можно использовать:
```bash
./security-signature <command> 2>&1 | tee debug.log
```

#### 6.3.2. Тестирование компонентов
```bash
# Запуск всех тестов
go test ./...

# Запуск с подробным выводом
go test -v ./...

# Запуск конкретного теста
go test -v ./tests -run TestGenerateKeyPairRSA
```

## 7. Обслуживание системы

### 7.1. Обновление системы

#### 7.1.1. Обновление из исходников
```bash
git pull origin main
go build -o security-signature ./cmd
```

#### 7.1.2. Обновление через go install
```bash
go install github.com/qyteboii/security-signature/cmd@latest
```

### 7.2. Резервное копирование
Рекомендуется регулярно создавать резервные копии:
- Исходного кода проекта
- Закрытых ключей (в зашифрованном виде)
- Конфигурационных файлов (если используются)

### 7.3. Мониторинг
Система не требует постоянного мониторинга, так как работает по требованию. Для автоматизации можно использовать:
- Cron (Linux/macOS) для периодической проверки файлов
- Task Scheduler (Windows) для планирования задач
- CI/CD системы для автоматической проверки подписей

## 8. Безопасность

### 8.1. Рекомендации по безопасности

#### 8.1.1. Хранение ключей
- Закрытые ключи должны храниться с правами доступа 0600
- Не храните закрытые ключи в системах с общим доступом
- Используйте шифрование для резервных копий закрытых ключей
- Регулярно ротируйте ключи

#### 8.1.2. Передача ключей
- Открытые ключи можно передавать открыто
- Используйте надежные каналы для первоначального обмена ключами
- Проверяйте подлинность открытых ключей через доверенные источники

#### 8.1.3. Использование алгоритмов
- Используйте ключи достаточной длины (минимум 2048 бит для RSA)
- Для новых проектов предпочтительнее ECDSA (меньший размер ключей при той же стойкости)
- Следите за актуальностью рекомендаций по криптографии

### 8.2. Аудит безопасности
Регулярно проверяйте:
- Версии используемых библиотек на наличие уязвимостей
- Актуальность алгоритмов и размеров ключей
- Права доступа к файлам ключей
- Логи доступа к системе (если ведется)

## 9. Производительность

### 9.1. Характеристики производительности
- Генерация RSA 2048 ключа: ~1-2 секунды
- Генерация ECDSA P-256 ключа: ~0.1 секунды
- Подпись файла 1 МБ: ~0.01 секунды
- Проверка подписи: ~0.01 секунды

### 9.2. Оптимизация
- Система использует потоковую обработку для больших файлов
- Криптографические операции выполняются нативно через стандартную библиотеку Go
- Дополнительная оптимизация не требуется для типичных сценариев использования

## 10. Интеграция с другими системами

### 10.1. Использование в скриптах
Система может быть интегрирована в bash/PowerShell скрипты для автоматизации:
```bash
#!/bin/bash
if ./security-signature verify -key pub.pem -in file.txt -sig file.sig; then
    echo "File is valid"
else
    echo "File verification failed"
    exit 1
fi
```

### 10.2. Использование в CI/CD
Пример интеграции в GitHub Actions:
```yaml
- name: Verify signature
  run: |
    ./security-signature verify -key public.pem -in artifact.tar.gz -sig artifact.sig
```

### 10.3. API для других языков
Система может быть вызвана из других языков через системные вызовы:
```python
import subprocess
result = subprocess.run(['./security-signature', 'verify', '-key', 'pub.pem', '-in', 'file.txt', '-sig', 'file.sig'])
```

## 11. Справочная информация

### 11.1. Структура файлов ключей

**RSA закрытый ключ (PEM)**:
```
-----BEGIN RSA PRIVATE KEY-----
...
-----END RSA PRIVATE KEY-----
```

**ECDSA закрытый ключ (PEM)**:
```
-----BEGIN EC PRIVATE KEY-----
...
-----END EC PRIVATE KEY-----
```

**Открытый ключ (PEM)**:
```
-----BEGIN PUBLIC KEY-----
...
-----END PUBLIC KEY-----
```

### 11.2. Формат подписи
Подпись сохраняется в виде Base64-кодированной строки в текстовом файле.

### 11.3. Коды возврата
- `0` — успешное выполнение
- `1` — ошибка выполнения

---

## СПИСОК ИСПОЛЬЗОВАННЫХ ИСТОЧНИКОВ

1. ГОСТ 34.201-89. Информационные технологии. Комплекс стандартов на автоматизированные системы. Виды, комплектность и обозначение документов при создании автоматизированных систем. — М.: Стандартинформ, 1989.

2. Руководство системного программиста системы подписи и проверки целостности файлов. Версия 1.0. — 2025.

3. RFC 3447. PKCS #1: RSA Cryptography Specifications Version 2.1. — 2003.

4. RFC 5480. Elliptic Curve Cryptography Subject Public Key Info. — 2009.

5. RFC 7468. Textual Encodings of PKIX, PKCS, and CMS Structures. — 2015.

6. The Go Programming Language Specification. Version 1.25. — https://go.dev/ref/spec

---

**Разработчик:** _________________  
**Дата:** _________________  
**Утверждено:** _________________

