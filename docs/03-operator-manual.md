# РУКОВОДСТВО ОПЕРАТОРА СИСТЕМЫ ПОДПИСИ И ПРОВЕРКИ ЦЕЛОСТНОСТИ ФАЙЛОВ

**Версия:** 1.0  
**Дата:** 2025  
**Статус:** Действующее

---

## СОДЕРЖАНИЕ

1. [Общие сведения](#1-общие-сведения)
2. [Описание системы](#2-описание-системы)
3. [Подготовка к работе](#3-подготовка-к-работе)
4. [Описание операций](#4-описание-операций)
5. [Типовые сценарии использования](#5-типовые-сценарии-использования)
6. [Сообщения оператору](#6-сообщения-оператору)
7. [Меры безопасности](#7-меры-безопасности)
8. [Техническая поддержка](#8-техническая-поддержка)

---

## 1. Общие сведения

### 1.1. Назначение документа
Настоящее руководство предназначено для операторов системы и содержит описание процедур установки, настройки и использования системы для подписи и проверки целостности файлов. Документ разработан в соответствии с требованиями ГОСТ 34.201-89 "Информационные технологии. Комплекс стандартов на автоматизированные системы. Виды, комплектность и обозначение документов при создании автоматизированных систем".

### 1.2. Краткая характеристика системы
Система представляет собой консольное приложение, позволяющее:
- Генерировать пары криптографических ключей (RSA и ECDSA)
- Создавать цифровые подписи для файлов
- Проверять целостность файлов путем верификации подписей

### 1.3. Состав системы
- Исполняемый файл `security-signature` (или `security-signature.exe` на Windows)
- Документация в формате Markdown

## 2. Описание системы

### 2.1. Назначение системы
Система предназначена для обеспечения целостности файлов. При создании подписи файла система гарантирует, что любое изменение файла будет обнаружено при проверке подписи.

### 2.2. Технические характеристики
- **Язык программирования**: Go
- **Минимальная версия Go**: 1.25.4
- **Зависимости**: только стандартная библиотека Go
- **Поддерживаемые ОС**: Windows, Linux, macOS
- **Поддерживаемые алгоритмы**: RSA (2048, 3072, 4096 бит), ECDSA (P-256, P-384, P-521)

## 3. Подготовка к работе

### 3.1. Требования к техническим средствам
- Компьютер с установленной операционной системой Windows, Linux или macOS
- Минимум 50 МБ свободного места на диске
- Права доступа для создания и чтения файлов

### 3.2. Требования к программному обеспечению
- Go версии 1.25.4 или выше (для сборки из исходников)
- Или предварительно собранный бинарный файл

### 3.3. Установка системы

#### 3.3.1. Установка из исходного кода
1. Убедитесь, что установлена версия Go 1.25.4 или выше:
   ```bash
   go version
   ```

2. Клонируйте репозиторий или распакуйте архив с исходным кодом:
   ```bash
   git clone https://github.com/snowwyd/security-signature.git
   cd security-signature
   ```

3. Соберите бинарный файл:
   ```bash
   go build -o security-signature ./cmd
   ```
   На Windows будет создан файл `security-signature.exe`.

4. Проверьте работу системы:
   ```bash
   ./security-signature help
   ```
   На Windows:
   ```powershell
   .\security-signature.exe help
   ```

#### 3.3.2. Установка через go install
```bash
go install github.com/qyteboii/security-signature/cmd@latest
```
После установки бинарник будет доступен в `$GOPATH/bin` или `$HOME/go/bin`.

#### 3.3.3. Добавление в PATH (опционально)
Для удобства использования добавьте папку с бинарником в переменную окружения PATH:

**Windows (PowerShell)**:
```powershell
[Environment]::SetEnvironmentVariable("Path", $Env:Path + ";C:\path\to\folder", "User")
```

**Linux/macOS**:
```bash
export PATH="$PATH:/path/to/folder"
echo 'export PATH="$PATH:/path/to/folder"' >> ~/.bashrc  # для bash
echo 'export PATH="$PATH:/path/to/folder"' >> ~/.zshrc   # для zsh
```

## 4. Описание операций

### 4.1. Генерация ключевых пар

#### 4.1.1. Назначение операции
Создание пары криптографических ключей (закрытого и открытого) для последующего использования при подписании и проверке файлов.

#### 4.1.2. Условия выполнения операции
- Наличие прав на создание файлов в целевой директории
- Достаточное место на диске (несколько килобайт)

#### 4.1.3. Подготовка к выполнению операции
Определите:
- Алгоритм (RSA или ECDSA)
- Для RSA: размер ключа (2048, 3072, 4096 бит)
- Для ECDSA: кривую (p256, p384, p521)
- Пути для сохранения ключей

#### 4.1.4. Выполнение операции

**Генерация RSA ключа (2048 бит)**:
```bash
./security-signature keygen -algo rsa -bits 2048 -out-priv private.pem -out-pub public.pem
```

**Генерация RSA ключа (3072 бит)**:
```bash
./security-signature keygen -algo rsa -bits 3072 -out-priv private.pem -out-pub public.pem
```

**Генерация ECDSA ключа (P-256)**:
```bash
./security-signature keygen -algo ecdsa -curve p256 -out-priv ecdsa_priv.pem -out-pub ecdsa_pub.pem
```

**Генерация ECDSA ключа (P-384)**:
```bash
./security-signature keygen -algo ecdsa -curve p384 -out-priv ecdsa_priv.pem -out-pub ecdsa_pub.pem
```

#### 4.1.5. Контроль выполнения операции
После выполнения операции проверьте:
- Создание файла закрытого ключа
- Создание файла открытого ключа
- Вывод сообщения об успешной генерации

**Пример вывода**:
```
Keys generated:
  Private: private.pem
  Public:  public.pem
```

#### 4.1.6. Возможные ошибки и способы их устранения

| Ошибка | Причина | Способ устранения |
|--------|---------|-------------------|
| `permission denied` | Нет прав на запись в директорию | Проверьте права доступа к директории |
| `unsupported algorithm` | Указан неверный алгоритм | Используйте `rsa` или `ecdsa` |
| `unsupported ECDSA curve` | Указана неверная кривая | Используйте `p256`, `p384` или `p521` |

### 4.2. Создание цифровой подписи

#### 4.2.1. Назначение операции
Создание цифровой подписи для файла с использованием закрытого ключа. Подпись гарантирует целостность файла.

#### 4.2.2. Условия выполнения операции
- Наличие файла закрытого ключа
- Наличие файла для подписания
- Права на чтение файла и ключа
- Права на создание файла подписи

#### 4.2.3. Подготовка к выполнению операции
Убедитесь, что:
- Файл закрытого ключа существует и доступен
- Файл для подписания существует
- Определен путь для сохранения подписи

#### 4.2.4. Выполнение операции

**Подпись файла с использованием закрытого ключа**:
```bash
./security-signature sign -key private.pem -in document.pdf -out document.sig
```

**Использование ключей по умолчанию**:
Если ключ находится в `private_key.pem`, можно не указывать параметр `-key`:
```bash
./security-signature sign -in document.pdf
```

#### 4.2.5. Контроль выполнения операции
После выполнения проверьте:
- Создание файла подписи
- Вывод сообщения об успешном создании подписи

**Пример вывода**:
```
Signature written to document.sig
```

#### 4.2.6. Возможные ошибки и способы их устранения

| Ошибка | Причина | Способ устранения |
|--------|---------|-------------------|
| `input file is required` | Не указан файл для подписания | Укажите параметр `-in` |
| `read private key: no such file` | Файл ключа не найден | Проверьте путь к файлу ключа |
| `open file: permission denied` | Нет прав на чтение файла | Проверьте права доступа |

### 4.3. Проверка цифровой подписи

#### 4.3.1. Назначение операции
Проверка целостности файла путем верификации его цифровой подписи с использованием открытого ключа.

#### 4.3.2. Условия выполнения операции
- Наличие файла открытого ключа
- Наличие проверяемого файла
- Наличие файла подписи
- Права на чтение всех файлов

#### 4.3.3. Подготовка к выполнению операции
Убедитесь, что:
- Файл открытого ключа существует
- Файл для проверки существует
- Файл подписи существует

#### 4.3.4. Выполнение операции

**Проверка подписи файла**:
```bash
./security-signature verify -key public.pem -in document.pdf -sig document.sig
```

**Использование ключей и подписи по умолчанию**:
Если ключ находится в `public_key.pem`, а подпись в `signature.sig`:
```bash
./security-signature verify -in document.pdf
```

#### 4.3.5. Контроль выполнения операции
При успешной проверке выводится сообщение:
```
Signature is valid
```

При неудачной проверке выводится сообщение об ошибке:
```
Error: signature verification failed: rsa verify: crypto/rsa: verification error
```

#### 4.3.6. Возможные ошибки и способы их устранения

| Ошибка | Причина | Способ устранения |
|--------|---------|-------------------|
| `input file is required` | Не указан файл для проверки | Укажите параметр `-in` |
| `read public key: no such file` | Файл ключа не найден | Проверьте путь к файлу ключа |
| `read signature: no such file` | Файл подписи не найден | Проверьте путь к файлу подписи |
| `signature verification failed` | Подпись не соответствует файлу | Файл был изменен или используется неверный ключ |

## 5. Типовые сценарии использования

### 5.1. Сценарий 1: Подпись и проверка документа

1. **Генерация ключей**:
   ```bash
   ./security-signature keygen -algo rsa -bits 2048
   ```

2. **Подпись документа**:
   ```bash
   ./security-signature sign -in important_document.pdf -out important_document.sig
   ```

3. **Передача файлов**:
   - Отправьте `important_document.pdf` и `important_document.sig` получателю
   - Отправьте `public_key.pem` получателю (открытый ключ можно передавать открыто)

4. **Проверка на стороне получателя**:
   ```bash
   ./security-signature verify -key public_key.pem -in important_document.pdf -sig important_document.sig
   ```

### 5.2. Сценарий 2: Использование ECDSA для меньшего размера ключей

1. **Генерация ECDSA ключей**:
   ```bash
   ./security-signature keygen -algo ecdsa -curve p256 -out-priv ecdsa_priv.pem -out-pub ecdsa_pub.pem
   ```

2. **Подпись файла**:
   ```bash
   ./security-signature sign -key ecdsa_priv.pem -in file.txt -out file.sig
   ```

3. **Проверка подписи**:
   ```bash
   ./security-signature verify -key ecdsa_pub.pem -in file.txt -sig file.sig
   ```

### 5.3. Сценарий 3: Автоматизация в скриптах

**Пример bash скрипта для подписания всех файлов в директории**:
```bash
#!/bin/bash
KEY="private.pem"
for file in *.pdf; do
    ./security-signature sign -key "$KEY" -in "$file" -out "${file}.sig"
    echo "Signed: $file"
done
```

**Пример PowerShell скрипта**:
```powershell
$key = "private.pem"
Get-ChildItem *.pdf | ForEach-Object {
    .\security-signature.exe sign -key $key -in $_.Name -out "$($_.Name).sig"
    Write-Host "Signed: $($_.Name)"
}
```

## 6. Сообщения оператору

### 6.1. Информационные сообщения

| Сообщение | Значение |
|-----------|----------|
| `Keys generated:` | Успешная генерация ключей |
| `Signature written to <file>` | Успешное создание подписи |
| `Signature is valid` | Подпись проверена успешно |

### 6.2. Сообщения об ошибках

| Сообщение | Причина | Действие |
|-----------|---------|----------|
| `input file is required` | Не указан обязательный параметр `-in` | Укажите файл для обработки |
| `read private key: no such file` | Файл ключа не найден | Проверьте путь к файлу |
| `signature verification failed` | Подпись не соответствует файлу | Файл изменен или неверный ключ |
| `unsupported algorithm` | Указан неверный алгоритм | Используйте `rsa` или `ecdsa` |

## 7. Меры безопасности

### 7.1. Защита закрытых ключей
- **Никогда не передавайте закрытый ключ** третьим лицам
- Храните закрытый ключ в безопасном месте
- Используйте права доступа 0600 (только владелец) для файла закрытого ключа
- Не храните закрытый ключ в системах с общим доступом

### 7.2. Защита открытых ключей
- Открытый ключ можно передавать открыто
- Убедитесь, что получатель использует правильный открытый ключ
- Рекомендуется использовать надежные каналы для первоначального обмена ключами

### 7.3. Рекомендации по использованию
- Используйте ключи достаточной длины (минимум 2048 бит для RSA, P-256 для ECDSA)
- Регулярно проверяйте целостность важных файлов
- Храните резервные копии закрытых ключей в безопасном месте
- Не используйте один и тот же ключ для разных целей

## 8. Техническая поддержка

### 8.1. Получение справки
Для получения справки по командам используйте:
```bash
./security-signature help
./security-signature keygen -h
./security-signature sign -h
./security-signature verify -h
```

### 8.2. Дополнительная документация
Полная документация находится в папке `docs/`:
- `01-specification.md` — техническая спецификация
- `02-requirements.md` — техническое задание
- `03-operator-manual.md` — настоящее руководство
- `04-system-programmer-manual.md` — руководство системного программиста
- `05-programmer-manual.md` — руководство программиста

### 8.3. Сообщение об ошибках
При обнаружении ошибок создайте issue в репозитории проекта с описанием:
- Версии системы и ОС
- Команды, которая вызвала ошибку
- Полного текста сообщения об ошибке
- Шагов для воспроизведения проблемы

---

## СПИСОК ИСПОЛЬЗОВАННЫХ ИСТОЧНИКОВ

1. ГОСТ 34.201-89. Информационные технологии. Комплекс стандартов на автоматизированные системы. Виды, комплектность и обозначение документов при создании автоматизированных систем. — М.: Стандартинформ, 1989.

2. Руководство оператора системы подписи и проверки целостности файлов. Версия 1.0. — 2025.

3. The Go Programming Language Specification. Version 1.25. — https://go.dev/ref/spec

---

**Разработчик:** _________________  
**Дата:** _________________  
**Утверждено:** _________________

